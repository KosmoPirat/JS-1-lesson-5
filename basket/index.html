<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
    <title>Lesson 5</title>
</head>
<body>

    <div id="basket"></div>
    <label for="num-products">Введите колличество продуктов которое хотите приобрести</label>
    <input id="num-products" type="number" placeholder="Введие колличество">
    <button id="basket-button">Buy</button>
    <button id="clear-basket">Clear Basket</button>
<script>
    "use strict";
    function getRandomInRange(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    let basket = {

        goodList: [],

        getRandomProduct() {
            let products = [
                {prodName: "коктейль Виноградный напиток", prodPrice: 234, prodIngredient: "вино, шампанское",count: 0},
                {prodName: "коктейль Адмирал", prodPrice: 423, prodIngredient: "вермут, виски",count: 0},
                {prodName: "коктейль Апельсиновое цветение", prodPrice: 455, prodIngredient: "джин",count: 0},
                {prodName: "коктейль Веселый еж", prodPrice: 774, prodIngredient: "вермут, виски",count: 0},
                {prodName: "коктейль Апельсиновый делайт", prodPrice: 765, prodIngredient: "водка, ликер",count: 0},
                {prodName: "коктейль Барьерный риф", prodPrice: 774, prodIngredient: "джин, ликер",count: 0},
                {prodName: "коктейль БИ И СИ", prodPrice: 231, prodIngredient: "кальвадос, ликер",count: 0},
                {prodName: "коктейль Александр Невский", prodPrice: 776, prodIngredient: "водка, ликер",count: 0},
                {prodName: "коктейль Водка 7", prodPrice: 986, prodIngredient: "водка", count: 0},
                {prodName: "коктейль Вандербильта", prodPrice: 235, prodIngredient: "бренди, ликер, биттер",count: 0},
                {prodName: "коктейль Биоплазма", prodPrice: 644, prodIngredient: "абсент, вино", count: 0},
                {prodName: "коктейль Бункер", prodPrice: 300, prodIngredient: "виски", count: 0},
                {prodName: "коктейль Ананасовый гудок", prodPrice: 455, prodIngredient: "джин, ликер",count: 0},
                {prodName: "коктейль Апельсиновая водка", prodPrice: 877, prodIngredient: "водка, ликер",count: 0},
                {prodName: "коктейль Брыкливая лошадь", prodPrice: 231, prodIngredient: "кальвадос, ром, вермут",count: 0},
                {prodName: "коктейль Белый груз", prodPrice: 765, prodIngredient: "джин",count: 0},
            ];
            return products[getRandomInRange(0, products.length - 1)];
        },

        countTotalPrice() {
            let totalCost = 0;
            this.goodList.forEach(function (item) {
                totalCost += item.prodPrice * item.count;
            });
            return totalCost;
        },

        countTotalNumber() {
            let totalCount = 0;
            this.goodList.forEach(function (item) {
                totalCount += item.count;
            });
            return totalCount;
        },

        putProduct(product) {
            this.goodList.push(Object.assign({}, product));
            this.goodList[this.goodList.length - 1].count++;
            for(let i = this.goodList.length - 2; i >= 0; i--) {
                if(this.goodList[this.goodList.length - 1].prodName === this.goodList[i].prodName){
                    this.goodList[i].count++;
                    this.goodList.pop();
                }
            }
        },

        fillBasket(numProd){
            for (let i = 0; i < numProd; i++) {
                this.putProduct(this.getRandomProduct());
            }
        },

    };

    function getNumProd() {
        let numProd = document.getElementById("num-products");
        if (+numProd.value <= 0) {
            alert("Не верное колличество товара повторите попытку!");
            return numProd.value = "";
        }

        basket.fillBasket(+numProd.value);
        basketIcon.innerHTML = basket.countTotalNumber();
        basketIcon.style.display = "block";
        numProd.value = '';
        showBasket();
    }

    function showBasket() {
        if (document.querySelector(".basket-body") == null) {
            let basketBody = document.createElement("div"),
                closeButton = document.createElement("div");
            basketBody.className = "basket-body";
            closeButton.id = "close";
            baskeForm.insertAdjacentElement("afterend", baskeForm.appendChild(basketBody));
            basketBody.insertAdjacentElement("afterbegin", basketBody.appendChild(closeButton));
            document.getElementById("close").onclick = closeBasket;
            console.log(basket.goodList);
            if (basket.goodList.length == []) {
                let par = document.createElement("p");
                par.innerHTML = "Козина пуста!";
                basketBody.insertAdjacentElement("beforeend", basketBody.appendChild(par));
            } else {
                let par = document.createElement("p");
                par.innerHTML =
                    `Колличество ваших товаров: ${basket.countTotalNumber()}<br>Сумма покупки: ${basket.countTotalPrice()}`;
                basketBody.insertAdjacentElement("beforeend", basketBody.appendChild(par));
            }
        } else {
            document.querySelector(".basket-body").remove();
            return showBasket();
        }
    }

    function closeBasket() {
        document.querySelector(".basket-body").remove();
    }

    function clearBasket() {
        basket.goodList = [];
        basketIcon.style.display = "none";
    }

    let baskeForm = document.querySelector("#basket");
    let basketIcon = document.createElement("div");
    basketIcon.id = 'basket-icon';
    baskeForm.insertAdjacentElement("afterbegin", basketIcon);
    document.getElementById("basket-button").onclick = getNumProd;
    document.getElementById("clear-basket").onclick = clearBasket;
    baskeForm.onclick = showBasket;
</script>
</body>
</html>